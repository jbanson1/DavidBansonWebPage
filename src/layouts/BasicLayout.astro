---
import { LINKS } from "../lib/constants";

interface Props {
  title: string;
  description: string;
  page?: "travel" | "blog";
  slug?: string | undefined;
  pubDate?: string;
}

const { title, description, page, pubDate } = Astro.props;
const image =
  page === "travel"
    ? `${Astro.url.origin}/globe_preview.webp"`
    : `${Astro.url.origin}/og-image.png`;

const schema =
  page !== "blog"
    ? {
        "@context": "http://schema.org",
        "@type": "Person",
        name: "David",
        url: Astro.url.origin,
        sameAs: [LINKS.linkedin, LINKS.github],
        image: `${Astro.url.origin}/og-image.png`,
        jobTitle: "Freelance Frontend Developer",
        worksFor: {
          "@type": "Organization",
          name: "Self-Employed",
          address: {
            "@type": "PostalAddress",
            addressLocality: "Italy",
            addressCountry: "IT",
          },
        },
        nationality: {
          "@type": "Country",
          name: "Italy",
        },
      }
    : {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        mainEntityOfPage: {
          "@type": "WebPage",
          "@id": Astro.url.href,
        },
        headline: title || title,
        description: description || title,
        image: `${Astro.url.origin}/og-image.png`, //TODO: dynamic
        author: {
          "@type": "Person",
          name: "David",
          url: Astro.url.origin,
          sameAs: [LINKS.linkedin, LINKS.github],
        },
        publisher: {
          "@type": "Organization",
          name: "David       ",
          logo: {
            "@type": "ImageObject",
            url: `${Astro.url.origin}/og-image.png`,
          },
        },
        datePublished: pubDate || new Date().toISOString(),
        dateModified: pubDate || new Date().toISOString(),
      };
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta content="width=device-width" name="viewport" />
    <link href="/favicon.ico" rel="icon" type="image/x-icon" />
    <meta content={Astro.generator} name="generator" />
    <title>{title}</title>
    <meta content={description} name="description" />
    <meta content="index, follow" name="robots" />
    <!-- Basic OG tags for sharing your website's content on platforms like Facebook and LinkedIn -->
    <meta content={title} property="og:title" />
    <meta content={description} property="og:description" />
    <meta content="website" property="og:type" />
    <meta content={Astro.url.origin} property="og:url" />
    <meta
      content={image || `${Astro.url.origin}/og-image.png`}
      property="og:image"
    />
    <!-- Basic Twitter Card tags -->
    <meta content="summary_large_image" name="twitter:card" />
    <meta content={title} name="twitter:title" />
    <meta content={description} name="twitter:description" />
    <meta
      content={image || `${Astro.url.origin}/og-image.png`}
      name="twitter:image"
    />

    <link href="https://cdn.fontshare.com" rel="preconnect" />
    <link href={Astro.url.href} rel="canonical" />
    <script
      is:inline
      set:html={JSON.stringify(schema)}
      type="application/ld+json"
    />
    <script is:inline>
      {
        `(function () {
          const root = document.documentElement;
          const storageKey = 'theme';
          const supportsMatchMedia = typeof window.matchMedia === 'function';
          const prefersDark = supportsMatchMedia ? window.matchMedia('(prefers-color-scheme: dark)').matches : false;
          let theme = prefersDark ? 'dark' : 'light';

          try {
            const stored = localStorage.getItem(storageKey);
            if (stored === 'light' || stored === 'dark') {
              theme = stored;
            }
          } catch (_) {
            /* ignore storage errors */
          }

          const apply = (value) => {
            const themeValue = value === 'dark' ? 'dark' : 'light';
            root.classList.remove('light', 'dark');
            root.classList.add(themeValue);
            root.setAttribute('data-theme', themeValue);
            try {
              root.style.colorScheme = themeValue;
            } catch (_) {
              /* ignore color-scheme assignment errors */
            }
          };

          apply(theme);
        })();`
      }
    </script>
    <script type="module" src="/src/scripts/theme-toggle.ts"></script>
  </head>
  <body
    class="md:h-screen flex flex-col justify-center items-center"
  >
    <slot name="loader" />
    <slot />
  </body>
</html>

<style is:global>
  @font-face {
    font-family: "CabinetGrotesk";
    src: url("/fonts/CabinetGrotesk-Variable.ttf") format("truetype-variations");
    font-weight: normal;
    font-style: normal;
    font-display: swap;
    font-weight: 100 1000;
  }
  @font-face {
    font-family: "Satoshi";
    src: url("/fonts/Satoshi-Variable.ttf") format("truetype-variations");
    font-weight: normal;
    font-style: normal;
    font-display: swap;
    font-weight: 100 1000;
  }

  :root {
    color-scheme: light;
    --color-background: #f5f5f5;
    --color-surface: #ffffff;
    --color-surface-hover: #f0f0f0;
    --color-border: #e5e5e5;
    --color-text: #171717;
    --color-text-muted: #4b5563;
    --color-button-bg: #ffffff;
    --color-icon: #111111;
  }

  @media (prefers-color-scheme: dark) {
    :root {
      color-scheme: dark;
      --color-background: #111111;
      --color-surface: #171717;
      --color-surface-hover: #1f1f1f;
      --color-border: #2c2c2c;
      --color-text: #f5f5f5;
      --color-text-muted: #a3a3a3;
      --color-button-bg: #171717;
      --color-icon: #f5f5f5;
    }
  }

  :root.light {
    color-scheme: light;
    --color-background: #f5f5f5;
    --color-surface: #ffffff;
    --color-surface-hover: #f0f0f0;
    --color-border: #e5e5e5;
    --color-text: #171717;
    --color-text-muted: #4b5563;
    --color-button-bg: #ffffff;
    --color-icon: #111111;
  }

  :root.dark {
    color-scheme: dark;
    --color-background: #111111;
    --color-surface: #171717;
    --color-surface-hover: #1f1f1f;
    --color-border: #2c2c2c;
    --color-text: #f5f5f5;
    --color-text-muted: #a3a3a3;
    --color-button-bg: #171717;
    --color-icon: #f5f5f5;
  }

  body {
    margin: 0;
    font-family: "Satoshi", sans-serif;
    -webkit-font-smoothing: antialiased;
    background-color: var(--color-background);
    color: var(--color-text);
    transition: background-color 0.3s ease, color 0.3s ease;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    font-family: "Cabinet Grotesk", sans-serif;
  }
  p {
    font-family: "Satoshi";
  }

  b {
    font-weight: 700 !important;
  }

  .card {
    background-color: var(--color-surface);
    border-color: var(--color-border);
    color: var(--color-text);
    transition: background-color 0.3s ease, border-color 0.3s ease;
  }

  .card a {
    color: inherit;
  }

  .card .text-gray-400,
  .card .text-gray-500 {
    color: var(--color-text-muted);
  }

  .card .text-white,
  .card .text-gray-200 {
    color: var(--color-text);
  }

  .custom-btn {
    background-color: var(--color-button-bg);
    color: var(--color-icon);
    transition: background-color 0.3s ease, color 0.3s ease;
  }

  .custom-btn .theme-icon {
    color: var(--color-icon);
    transition: color 0.3s ease;
  }

  .loader {
    background-color: var(--color-background);
    color: var(--color-text);
  }

  .theme-chip {
    background-color: var(--color-button-bg);
    border: 1px solid var(--color-border);
    color: var(--color-text);
    transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease;
  }

  .theme-chip:hover {
    background-color: var(--color-surface-hover);
  }

  .text-muted {
    color: var(--color-text-muted);
  }

  .theme-prose {
    color: var(--color-text);
  }

  .theme-prose :where(p, li, h1, h2, h3, h4, h5, h6, strong, em, span, code) {
    color: var(--color-text);
  }

  .theme-prose :where(a) {
    color: inherit;
  }

  .theme-prose :where(pre, code) {
    background-color: var(--color-surface-hover);
  }

  #theme-toggle .icon-on {
    display: none;
  }

  #theme-toggle .icon-off {
    display: inline;
  }

  .light #theme-toggle .icon-on {
    display: inline;
  }

  .dark #theme-toggle .icon-off {
    display: inline;
  }

  .light #theme-toggle .icon-off,
  .dark #theme-toggle .icon-on {
    display: none;
  }

  @media (prefers-color-scheme: light) {
    html:not(.light):not(.dark) #theme-toggle .icon-on {
      display: inline;
    }
    html:not(.light):not(.dark) #theme-toggle .icon-off {
      display: none;
    }
  }

  @media (prefers-color-scheme: dark) {
    html:not(.light):not(.dark) #theme-toggle .icon-off {
      display: inline;
    }
  }
</style>
